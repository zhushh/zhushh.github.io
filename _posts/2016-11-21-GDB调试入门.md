---
layout: post
title: "GDB调试程序"
description: "gdb调试程序说明"
og_image: "documentation/sample-image.jpg"
tags: [gdb, debug, 调试]
---


一、常用命令
----
(gdb) list // 列出源代码，每次10行

(gdb) list 行号 // 列出第几行开始的源代码

(gdb) list 函数名 // 列出某个函数的源代码

(gdb) b 行号 // 在第几行设置断点

(gdb) b 函数名func // 在函数func的入口处设置断点

(gdb) info break // 查看断点信息

(gdb) info locals // 查看当前栈帧局部变量

(gdb) start // 开始执行程序，停在main函数第一行语句前面等待命令

(gdb) run // 运行程序

(gdb) next // 单步执行

(gdb) step // 单步调试，如果有函数调用，进入函数

(gdb) continue // 继续运行

(gdb) print 变量名 // 打印变量的值

(gdb) display 变量名 // 每次中断或单步都显示你关心的变量

(gdb) bt // 查看函数堆栈

(gdb) frame 栈帧号 // 打印指定帧号的函数栈信息

(gdb) set args 参数值列表 // 指定运行时的参数

(gdb) show args // 查看设置好的参数

(gdb) finish // 连续运行当前函数到返回为止，然后停下来等待命令

(gdb) quit // 退出gdb调试

(gdb) delete 断点号n // 删除第n个断点

(gdb) disable 断点号n // 暂停第n个断点号

(gdb) enable 断点号n // 开启第n个断点号

(gdb) b n if condition // 如果condition表达式为true，就在第n行设置断点



二、gdb记录输出信息到文件
----

(gdb) set logging on    // 开启记录输出信息

(gdb) set logging off   // 关闭记录输出信息

(gdb) show logging      // 显示记录输出信息状态

三、core文件生成
----
1.什么是core文件？

在程序不正常退出时，内核在当前工作目录下生成一个core文件（是一个内存映像，同时加上调试信息）；使用
gdb来查看core文件，可以指示导致程序出错的代码所在文件和行数；

2.如何开启core文件？

用`ulimit -a`命令查看是否开启core文件，如果`core file size`的值为0，那么就是还没有开启；
可以使用命令`ulimit -c unlimited`开启;

3.如何查看core文件？

core文件需要使用gdb来查看，使用bt命令即可看到程序出错的地方；假设程序a.out运行出错，生成core文件，
使用方式如下查看core文件：
```shell
$ gdb a.out                         // 这里启动a.out
...
(gdb) core-file core                // 导入core文件
[New LWP 10491]
Core was generated by `./a.out'.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000000000000000 in ?? ()
(gdb) bt                            // 查看堆栈信息
#0  0x0000000000000000 in ?? ()
#1  0x0000000000400670 in main (argc=0, argv=0x400500 <_start>) at test.cpp:25
(gdb)
```

四、gdb多线程调试
----

1.(gdb) info threads  // 用来显示线程数

2.(gdb) thread ID  // 切换到指定线程

3.(gdb) set scheduler-locking off|on|step   // 设置线程调度

